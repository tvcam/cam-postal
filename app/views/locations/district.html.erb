<% content_for :title, "#{t('district.title', name: @district.name_en)} - #{@province.name_en} | #{t('site.name')}" %>

<% content_for :head do %>
  <meta name="description" content="<%= t('district.meta_description', name: @district.name_en, count: @communes.count) %>">
  <link rel="canonical" href="<%= province_district_url(@province.name_en.parameterize, @district.name_en.parameterize) %>">
  <meta property="og:title" content="<%= t('district.title', name: @district.name_en) %>, <%= @province.name_en %>">
  <meta property="og:description" content="<%= t('district.meta_description', name: @district.name_en, count: @communes.count) %>">
<% end %>

<% content_for :structured_data do %>
  <!-- BreadcrumbList Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "<%= t('breadcrumb.home') %>",
        "item": "https://cam-postal.gotabs.net/"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "<%= t('breadcrumb.provinces') %>",
        "item": "https://cam-postal.gotabs.net/provinces"
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": "<%= @province.name_en %>",
        "item": "https://cam-postal.gotabs.net/provinces/<%= @province.name_en.parameterize %>"
      },
      {
        "@type": "ListItem",
        "position": 4,
        "name": "<%= @district.name_en %>",
        "item": "https://cam-postal.gotabs.net/provinces/<%= @province.name_en.parameterize %>/<%= @district.name_en.parameterize %>"
      }
    ]
  }
  </script>

  <!-- AdministrativeArea Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "AdministrativeArea",
    "name": "<%= @district.name_en %>",
    <% if @district.name_km.present? %>"alternateName": "<%= @district.name_km %>",<% end %>
    "address": {
      "@type": "PostalAddress",
      "postalCode": "<%= @district.postal_code %>",
      "addressLocality": "<%= @district.name_en %>",
      "addressRegion": "<%= @province.name_en %>",
      "addressCountry": "KH"
    },
    "containedInPlace": {
      "@type": "AdministrativeArea",
      "name": "<%= @province.name_en %>",
      "containedInPlace": {
        "@type": "Country",
        "name": "Cambodia"
      }
    }
  }
  </script>
<% end %>

<div class="location-page">
  <nav class="breadcrumb" aria-label="Breadcrumb">
    <ol>
      <li><a href="<%= root_path %>"><%= t('breadcrumb.home') %></a></li>
      <li><a href="<%= provinces_path %>"><%= t('breadcrumb.provinces') %></a></li>
      <li><a href="<%= province_path(@province.name_en.parameterize) %>"><%= @province.name_en %></a></li>
      <li aria-current="page"><%= @district.name_en %></li>
    </ol>
  </nav>

  <header class="location-header">
    <div class="location-title-row">
      <div>
        <h1><%= t('district.title', name: @district.name_en) %></h1>
        <% if @district.name_km.present? %>
          <p class="location-name-km"><%= @district.name_km %></p>
        <% end %>
        <p class="location-parent"><%= t('province.title', name: @province.name_en) %></p>
      </div>
      <div class="location-code-badge">
        <span class="code-label"><%= t('district.code_label') %></span>
        <span class="code-value"><%= @district.postal_code %></span>
      </div>
    </div>
    <p class="location-subtitle"><%= t('district.subtitle', count: @communes.count, name: @district.name_en) %></p>
  </header>

  <div class="communes-grid">
    <% @communes.each do |commune| %>
      <a href="<%= postal_code_path(commune.postal_code) %>" class="commune-card"
         data-controller="copy"
         data-copy-text-value="<%= commune.postal_code %>"
         data-action="click->copy#copyAndPrevent">
        <div class="commune-code"><%= commune.postal_code %></div>
        <div class="commune-info">
          <h2 class="commune-name"><%= commune.name_en %></h2>
          <% if commune.name_km.present? %>
            <p class="commune-name-km"><%= commune.name_km %></p>
          <% end %>
        </div>
        <span class="copy-hint"><%= t('home.click_to_copy') %></span>
      </a>
    <% end %>
  </div>

  <% if @communes.empty? %>
    <div class="empty-state">
      <p><%= t('district.empty_state', code: @district.postal_code) %></p>
      <div class="district-only-card"
           data-controller="copy"
           data-copy-text-value="<%= @district.postal_code %>"
           data-action="click->copy#copy">
        <span class="postal-code"><%= @district.postal_code %></span>
        <span class="copy-hint"><%= t('home.click_to_copy') %></span>
      </div>
    </div>
  <% end %>

  <div class="location-footer">
    <p><%= t('district.footer_note', name: @district.name_en, prefix: @district.postal_code[0,4]) %></p>
    <div class="footer-links">
      <a href="<%= province_path(@province.name_en.parameterize) %>" class="back-link">‚Üê <%= t('district.back_link', province: @province.name_en) %></a>
      <a href="<%= root_path %>" class="search-link"><%= t('provinces.search_link') %></a>
    </div>
  </div>
</div>
