<% content_for :title, "#{@district.name_en} Postal Codes - Communes in #{@district.name_en}, #{@province.name_en}" %>

<% content_for :head do %>
  <meta name="description" content="All postal codes for <%= @district.name_en %><%= " (#{@district.name_km})" if @district.name_km.present? %> district in <%= @province.name_en %>, Cambodia. Browse <%= @communes.count %> communes with ZIP codes.">
  <link rel="canonical" href="<%= province_district_url(@province.name_en.parameterize, @district.name_en.parameterize) %>">
  <meta property="og:title" content="<%= @district.name_en %>, <%= @province.name_en %> - Postal Codes">
  <meta property="og:description" content="Find postal codes for all <%= @communes.count %> communes in <%= @district.name_en %> district, <%= @province.name_en %>.">
<% end %>

<% content_for :structured_data do %>
  <!-- BreadcrumbList Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "https://cam-postal.gotabs.net/"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "Provinces",
        "item": "https://cam-postal.gotabs.net/provinces"
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": "<%= @province.name_en %>",
        "item": "https://cam-postal.gotabs.net/provinces/<%= @province.name_en.parameterize %>"
      },
      {
        "@type": "ListItem",
        "position": 4,
        "name": "<%= @district.name_en %>",
        "item": "https://cam-postal.gotabs.net/provinces/<%= @province.name_en.parameterize %>/<%= @district.name_en.parameterize %>"
      }
    ]
  }
  </script>

  <!-- AdministrativeArea Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "AdministrativeArea",
    "name": "<%= @district.name_en %>",
    <% if @district.name_km.present? %>"alternateName": "<%= @district.name_km %>",<% end %>
    "address": {
      "@type": "PostalAddress",
      "postalCode": "<%= @district.postal_code %>",
      "addressLocality": "<%= @district.name_en %>",
      "addressRegion": "<%= @province.name_en %>",
      "addressCountry": "KH"
    },
    "containedInPlace": {
      "@type": "AdministrativeArea",
      "name": "<%= @province.name_en %>",
      "containedInPlace": {
        "@type": "Country",
        "name": "Cambodia"
      }
    }
  }
  </script>

  <!-- ItemList Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "ItemList",
    "name": "Communes in <%= @district.name_en %>",
    "numberOfItems": <%= @communes.count %>,
    "itemListElement": [
      <% @communes.each_with_index do |commune, index| %>
      {
        "@type": "ListItem",
        "position": <%= index + 1 %>,
        "name": "<%= commune.name_en %>",
        "url": "https://cam-postal.gotabs.net/p/<%= commune.postal_code %>"
      }<%= index < @communes.count - 1 ? ',' : '' %>
      <% end %>
    ]
  }
  </script>
<% end %>

<div class="location-page">
  <nav class="breadcrumb" aria-label="Breadcrumb">
    <ol>
      <li><a href="<%= root_path %>">Home</a></li>
      <li><a href="<%= provinces_path %>">Provinces</a></li>
      <li><a href="<%= province_path(@province.name_en.parameterize) %>"><%= @province.name_en %></a></li>
      <li aria-current="page"><%= @district.name_en %></li>
    </ol>
  </nav>

  <header class="location-header">
    <div class="location-title-row">
      <div>
        <h1><%= @district.name_en %> District</h1>
        <% if @district.name_km.present? %>
          <p class="location-name-km"><%= @district.name_km %></p>
        <% end %>
        <p class="location-parent"><%= @province.name_en %> Province</p>
      </div>
      <div class="location-code-badge">
        <span class="code-label">District Code</span>
        <span class="code-value"><%= @district.postal_code %></span>
      </div>
    </div>
    <p class="location-subtitle">Browse <%= @communes.count %> communes in <%= @district.name_en %></p>
  </header>

  <div class="communes-grid">
    <% @communes.each do |commune| %>
      <a href="<%= postal_code_path(commune.postal_code) %>" class="commune-card"
         data-controller="copy"
         data-copy-text-value="<%= commune.postal_code %>"
         data-action="click->copy#copy">
        <div class="commune-code"><%= commune.postal_code %></div>
        <div class="commune-info">
          <h2 class="commune-name"><%= commune.name_en %></h2>
          <% if commune.name_km.present? %>
            <p class="commune-name-km"><%= commune.name_km %></p>
          <% end %>
        </div>
        <span class="copy-hint">Click to copy</span>
      </a>
    <% end %>
  </div>

  <% if @communes.empty? %>
    <div class="empty-state">
      <p>No communes found in this district. The postal code <strong><%= @district.postal_code %></strong> covers the entire district.</p>
      <div class="district-only-card"
           data-controller="copy"
           data-copy-text-value="<%= @district.postal_code %>"
           data-action="click->copy#copy">
        <span class="postal-code"><%= @district.postal_code %></span>
        <span class="copy-hint">Click to copy</span>
      </div>
    </div>
  <% end %>

  <div class="location-footer">
    <p>All postal codes in <%= @district.name_en %> start with <strong><%= @district.postal_code[0,4] %></strong>.</p>
    <div class="footer-links">
      <a href="<%= province_path(@province.name_en.parameterize) %>" class="back-link">‚Üê Back to <%= @province.name_en %></a>
      <a href="<%= root_path %>" class="search-link">Search postal codes</a>
    </div>
  </div>
</div>
