<h1>Search Analytics</h1>

<div class="period-filter">
  <%= link_to "Today", admin_search_logs_path(period: "today"), class: @period == "today" ? "active" : "" %>
  <%= link_to "This Week", admin_search_logs_path(period: "week"), class: @period == "week" ? "active" : "" %>
  <%= link_to "This Month", admin_search_logs_path(period: "month"), class: @period == "month" ? "active" : "" %>
  <%= link_to "All Time", admin_search_logs_path(period: "all"), class: @period == "all" ? "active" : "" %>
</div>

<div class="stats-grid">
  <div class="stat-card">
    <div class="value"><%= number_with_delimiter(@total_searches) %></div>
    <div class="label">Total Searches</div>
  </div>
  <div class="stat-card">
    <div class="value"><%= number_with_delimiter(@unique_queries) %></div>
    <div class="label">Unique Queries</div>
  </div>
  <div class="stat-card">
    <div class="value"><%= number_with_delimiter(SiteStat.searches) %></div>
    <div class="label">All-Time Searches</div>
  </div>
  <div class="stat-card">
    <div class="value"><%= number_with_delimiter(SiteStat.visits) %></div>
    <div class="label">All-Time Visits</div>
  </div>
</div>

<div class="two-columns">
  <div class="section">
    <h2>Top Queries</h2>
    <div class="top-queries-list">
      <% @top_queries.each do |query, count| %>
        <div class="top-query">
          <span class="query"><%= query %></span>
          <span class="count"><%= count %></span>
        </div>
      <% end %>
      <% if @top_queries.empty? %>
        <p class="text-muted">No searches recorded yet.</p>
      <% end %>
    </div>
  </div>

  <div class="section">
    <h2>Recent Searches</h2>
    <table class="data-table">
      <thead>
        <tr>
          <th>Query</th>
          <th>Results</th>
          <th>Time</th>
          <th>IP</th>
        </tr>
      </thead>
      <tbody>
        <% @search_logs.each do |log| %>
          <tr>
            <td><%= log.query %></td>
            <td><%= log.results_count %></td>
            <td class="text-muted"><%= time_ago_in_words(log.created_at) %> ago</td>
            <td class="text-muted truncate"><%= log.ip_address || "-" %></td>
          </tr>
        <% end %>
        <% if @search_logs.empty? %>
          <tr>
            <td colspan="4" class="text-muted">No searches recorded yet.</td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
